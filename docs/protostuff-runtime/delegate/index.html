<!DOCTYPE html><html><head><title>protostuff docs - delegate</title><meta charset="utf-8"/><meta http-equiv="content-type" content="text/html;charset=utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="stylesheet" href="../../../assets/css/site.css"/></head><body><div class="absolute show-md"><div class="dropdown"><button class="btn btn-link btn-sm dropdown-toggle circle shadow-gray"> # </button><div class="menu hover"><div class="menu-item"><ul class="nav"><li class="nav-item"><a href="../../">Docs</a><ul class="nav"><li class="nav-item"><a href="../">protostuff-runtime</a><ul class="nav"><li class="nav-item active"><a href="./">Delegate</a></li></ul></li></ul></li></ul></div></div></div></div><div class="container"><header class="columns col-gapless"><div class="column col-8 col-mx-auto col-xl-6 col-md-5 col-sm-6 col-xs-8"><nav><a class="img" href="../../../"><img src="/assets/images/protostuff.png"/></a><a class="img" href="https://github.com/protostuff/protostuff" target="_blank" rel="noreferrer"><img src="/assets/images/gh.png"/></a><a class="chip active" href="../../">Docs</a></nav></div><div class="column col-12 show-md"><ul class="breadcrumb"><li class="breadcrumb-item"><a href="../../">Docs</a></li><li class="breadcrumb-item"><a href="../">protostuff-runtime</a></li><li class="breadcrumb-item"><span>Delegate</span></li></ul></div></header><main class="columns col-gapless"><div class="column col-2 col-xl-3 hide-md sidebar"><ul class="nav"><li class="nav-item"><a href="../../">Docs</a><ul class="nav"><li class="nav-item"><a href="../">protostuff-runtime</a><ul class="nav"><li class="nav-item active"><a href="./">Delegate</a></li></ul></li></ul></li></ul></div><div class="column col-8 col-mr-auto col-xl-6 col-md-12 main"><p><code>Delegate</code> is available since version 1.0.7 (protostuff-runtime).</p>
<p><strong>It is useful for:</strong></p>
<ol>
<li>Singletons.</li>
<li>POJOs with no fields.</li>
<li>POJOs that should not be merged.</li>
<li>POJOs that prefer to be written as scalar/inline values.</li>
<li>Could be used to pack primitive array types into a byte array.</li>
<li>Override protostuff-runtime’s internal serializers for scalar fields (delegates have the first priority).</li>
</ol>
<p>You should register them on initialization via <code>DefaultIdStrategy.registerDelegate(Delegate&lt;V&gt; delegate)</code>.</p>
<p>If you use different IdStrategy, then use one of:</p>
<ul>
<li><code>ExplicitIdStrategy.Registry.registerDelegate(Delegate&lt;V&gt; delegate, int id)</code></li>
<li><code>IncrementalIdStrategy.Registry.registerDelegate(Delegate&lt;V&gt; delegate, int id)</code></li>
</ul>
<p><strong>Here’s an example for 1 or 2.</strong></p>
<pre class="lang language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Singleton INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Object obj<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">==</span> obj <span class="token operator">&amp;&amp;</span> obj <span class="token operator">==</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">identityHashCode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Delegate<span class="token operator">&lt;</span>Singleton<span class="token operator">></span> SINGLETON_DELEGATE <span class="token operator">=</span> 
        <span class="token keyword">new</span> <span class="token class-name">Delegate</span><span class="token operator">&lt;</span>Singleton<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">typeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> FieldType <span class="token function">getFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> FieldType<span class="token punctuation">.</span>UINT32<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeTo</span><span class="token punctuation">(</span>Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> Singleton value<span class="token punctuation">,</span> 
            <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        output<span class="token punctuation">.</span><span class="token function">writeUInt32</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Singleton <span class="token function">readFrom</span><span class="token punctuation">(</span>Input input<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">!=</span> input<span class="token punctuation">.</span><span class="token function">readUInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ProtostuffException</span><span class="token punctuation">(</span><span class="token string">"Corrupt input."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Singleton<span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>Pipe pipe<span class="token punctuation">,</span> Input input<span class="token punctuation">,</span> Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        output<span class="token punctuation">.</span><span class="token function">writeUInt32</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> input<span class="token punctuation">.</span><span class="token function">readUInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>Here’s an example for 3 or 4.</strong></p>
<pre class="lang language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Delegate<span class="token operator">&lt;</span>UUID<span class="token operator">></span> UUID_DELEGATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Delegate</span><span class="token operator">&lt;</span>UUID<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> FieldType <span class="token function">getFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> FieldType<span class="token punctuation">.</span>BYTES<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">typeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> UUID<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> UUID <span class="token function">readFrom</span><span class="token punctuation">(</span>Input input<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ProtostuffException</span><span class="token punctuation">(</span><span class="token string">"Corrupt input."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UUID</span><span class="token punctuation">(</span><span class="token function">toInt64</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toInt64</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeTo</span><span class="token punctuation">(</span>Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> UUID value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token function">writeInt64</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">getMostSignificantBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">writeInt64</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">getLeastSignificantBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        output<span class="token punctuation">.</span><span class="token function">writeByteArray</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>Pipe pipe<span class="token punctuation">,</span> Input input<span class="token punctuation">,</span> Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> 
            <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        input<span class="token punctuation">.</span><span class="token function">transferByteRangeTo</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> number<span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">toInt64</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b1 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b2 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b3 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b4 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b5 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b6 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b7 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span> b8 <span class="token operator">=</span> buffer<span class="token punctuation">[</span>offset<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b8 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b7 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span>  <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b6 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b5 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b4 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b3 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b2 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">48</span><span class="token punctuation">)</span> <span class="token operator">|</span>
         <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>b1 <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeInt64</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">long</span> value<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> offset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span>  <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">[</span>offset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value <span class="token operator">>>></span>  <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Here’s an example for 5.</strong></p>
<pre class="lang language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Delegate<span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> SHORT_ARRAY_DELEGATE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Delegate</span><span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">typeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> FieldType <span class="token function">getFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> FieldType<span class="token punctuation">.</span>BYTES<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeTo</span><span class="token punctuation">(</span>Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token punctuation">,</span> 
            <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>value<span class="token punctuation">.</span>length<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">short</span> s <span class="token operator">=</span> value<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">>>></span>  <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">>>></span>  <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        output<span class="token punctuation">.</span><span class="token function">writeByteArray</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">readFrom</span><span class="token punctuation">(</span>Input input<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">short</span><span class="token punctuation">[</span>buffer<span class="token punctuation">.</span>length<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>offset<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>Pipe pipe<span class="token punctuation">,</span> Input input<span class="token punctuation">,</span> Output output<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">,</span> 
            <span class="token keyword">boolean</span> repeated<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException
    <span class="token punctuation">{</span>
        input<span class="token punctuation">.</span><span class="token function">transferByteRangeTo</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> number<span class="token punctuation">,</span> repeated<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></main></div><footer><p>Copyright © 2018 <a href="https://github.com/dyu">David</a> <a href="https://gitlab.com/dyu">Yu</a></p>
</footer></body></html>